# Параграф 6: Поиск ошибок

## Как получить логи

В первую очередь в поиске ошибок стоит начать с лога Android. Его можно достать с помощью команды ADB:

```bash
adb logcat > log.txt
```

Однако для работы ADB требуется включить в настройках разработчика отладку по USB, что не всегда возможно, особенно если прошивка не загружается и это первая загрузка. Тут требуется провести ADB unsecure. Требуется добавить следующие пропы и сделать сброс до заводских настроек:

```makefile
PRODUCT_PROPERTY_OVERRIDES += \
    persist.sys.usb.config=mtp,adb \
    ro.adb.secure=0 \
    ro.secure=0 \
    ro.debuggable=1
```

Если что-то поменяется в будущем в Android, то можно в GitHub написать "ADB unsecure" и таким образом найти более новый способ, как провести эту процедуру.

Также можно получить лог ядра. Чтобы его получить, требуется выполнить команду на устройстве. Чтобы получить доступ к командной строке устройства, требуется выполнить следующую команду:

```bash
adb shell
```

После надо выполнить эту команду:

```bash
dmesg > /sdcard/dmesg_log.txt
```

Чтобы выйти из командной строки устройства, требуется выполнить следующую команду:

```bash
exit
```

## Типичные ошибки в логе Android

* Невозможность открыть библиотеку:

  Ключевым словом в логе будет `dlopen`. Пример:

  ```
  07-15 21:11:08.860  5371  5371 E CamX    : [ERROR][UTILS  ] camxosutilslinux.cpp:933 LibMap() dlopen: dlopen failed: library "libpng.so" not found: needed by /vendor/lib64/camera/components/com.mi.node.watermark.so in namespace (default), on '/vendor/lib64/camera/components/com.mi.node.watermark.so'
  ```

* Ошибка SEPolicy:

  Ключевым словом в логе будет `avc`. Пример:
  
  ```
  E SELinux : avc:  denied  { find } for interface=vendor.xiaomi.hardware.quickcamera::IQuickCameraService sid=u:r:hal_camera_default:s0 pid=1341 scontext=u:r:hal_camera_default:s0 tcontext=u:object_r:hal_quickcamera_hwservice:s0 tclass=hwservice_manager permissive=0
  ```

* Отсутствие функции:

  Ключевым выражением в логе будет `cannot locate symbol`. Пример:
  
  ```
  E vndksupport: dlopen failed: cannot locate symbol "_ZN7android15PermissionCache15checkPermissionERKNS_8String16Eij" referenced by "/vendor/lib64/libgoodixfingerprintd_binder.so"
  ```

## Как ловить проблему

Стоит искать что-то повторяющееся и подходящее по смыслу. То есть, если не работает камера, то стоит обращать внимание на логи и ошибки, связанные с камерой. Также стоит несколько раз подряд вызвать ошибку, чтобы было проще понять, что конкретно это влияет на работоспособность того или иного функционала устройства.
