# Параграф 5: Инициализация и сборка

И вот мы переходим к самому ~~интересному~~, страшному и интригующему в этой главе - к сборке готовой прошивки!

Для начала требуется настроить окружение, что происходит посредством запуска скрипта `build/envsetup.sh`. Тут уместна шутка "есть два типа людей":

```bash
. build/envsetup.sh
```

```bash
source build/envsetup.sh
```

Да, это два варианта как запустить скрипт. Автор данного текста относит себя к первому типу людей.

Окей, теперь требуется указать системе сборки под какое устройство происходит сборка. Это можно сделать двумя путями.

### Инициализация командой, доступной в AOSP

Команда инициализации должна быть следующей:

```bash
lunch lineage_codename-userdebug
```

С Android 14/Lineage OS 21.0 команда быть с указанием квартального релиза AOSP:

```bash
lunch lineage_codename-aosp_target_release-userdebug
```

::: tip **Примечание!** 
Можно ввести команду `lunch` без каких-то либо аргументов и он выведет вам списко всех устройств, которых нашел. Там может быть под эмулятор Android для Android Studio, официальные устройства и под ваше устройство, если вы правильно все сделали, но рекомендую делать как выше, меньше проблем и быстрее.
:::

Где `codename` - кодовое название устройства, `aosp_target_release` - квартальный релиз AOSP, которая является базой скачанной прошивки. Не боимся, сидим и ждем, когда система сборки сделает все, что требуется.

![lunch](/Chapter1/lunch.png)

### Инициализация командой, доступной в Lineage OS

Команда следующая:

```bash
breakfast codename
```

### Сборка

Отлично! Мы можем почитать почти всю информацию об устройстве, на которое собираем прошивку, и немного об ОС, которая стоит на машине для сборки. Теперь мы готовы собирать. Есть три варианта:

1) Сборка прошивки с использованием make и количеством потоков. Если не указывать количество потоков, то сборка будет происходить в однопоточном режиме:

```bash
make bacon -j#
```

2) Сборка прошивки с использованием mka, он автоматически установит нужное количество потоков для сборки:

```bash
mka bacon
```

В чем разница? Об этом нам скажет [Mirsaid02](https://4pda.to/forum/index.php?showuser=4383879) с 4PDA:

:::tip 
**mka** - лучшая команда для сборки в плане качества, т. к. использует программу sched_tool, при сборке будет возникать меньше ошибок, выбирает для каждой части сборки подходящий компилятор, но при этом сборка проходит на несколько часов дольше, в зависимости от ТХ вашего ПК или ноутбука, также его называют "супер-заряженной" версией make.
* [Пост](https://4pda.to/forum/index.php?showtopic=209610&view=findpost&p=44763389)
:::

3) Инициализация и сборка прошивки одной командой:

```bash
brunch codename
```